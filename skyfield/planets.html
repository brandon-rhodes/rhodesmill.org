<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planets, and Choosing an Ephemeris</title>
    <link rel="stylesheet" type="text/css" href="_static/style.css">
  </head>
  <body>
    
    <p class="motto">
      <b>Skyfield:</b>
      <a href=".">Home</a>
      •
      <a href="toc.html">Table of Contents</a>
      •
      <a href="installation.html#changelog">Changelog</a>
      •
      <a href="api.html">API Reference</a>
    </p>
    
    <div class="section" id="planets-and-choosing-an-ephemeris">
<h1>Planets, and Choosing an Ephemeris<a class="headerlink" href="#planets-and-choosing-an-ephemeris" title="Permalink to this headline">¶</a></h1>
<p>If you are interested in observing the planets,
the Jet Propulsion Laboratory (JPL)
has prepared long tables that predict the positions of the planets
both in the the distant past and out into the future.
A&nbsp;table of positions is called an <em>ephemeris</em>
and those supplied by the JPL are of very high accuracy.</p>
<p>You can ask Skyfield to download an ephemeris from the JPL
by giving <code class="docutils literal notranslate"><span class="pre">load()</span></code> a filename.
Or you can load an ephemeris that you’ve already saved to disk
with <a class="reference internal" href="api-iokit.html#skyfield.iokit.load_file" title="skyfield.iokit.load_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_file()</span></code></a>.</p>
<p>A popular choice of ephemeris is DE421.
It is recent, has good precision,
was designed for general-purpose use,
and is only 17&nbsp;MB in size:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skyfield.api</span> <span class="kn">import</span> <span class="n">load</span>
<span class="n">planets</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s1">&#39;de421.bsp&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Once an ephemeris file has been downloaded to your current directory,
re-running your program will simply reuse the copy on disk
instead of downloading it all over again.</p>
<p>After you have loaded an ephemeris and have used a statement like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mars</span> <span class="o">=</span> <span class="n">planets</span><span class="p">[</span><span class="s1">&#39;Mars&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>— to retrieve a planet, consult the chapter <a class="reference internal" href="positions.html"><span class="doc">Positions and Coordinates</span></a>
to learn about all the positions that you can use it to generate.</p>
<p>If you want to examine the segments that make up the ephemeris,
you can loop over its <code class="docutils literal notranslate"><span class="pre">segments</span></code> list.
You can <code class="docutils literal notranslate"><span class="pre">print()</span></code> a segment to see a textual description,
or access segment attributes that give its center, target,
and the dates over which it provides valid positions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">timescale</span><span class="p">()</span>

<span class="n">segment</span> <span class="o">=</span> <span class="n">planets</span><span class="o">.</span><span class="n">segments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">time_range</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Center:&#39;</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">center_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Target:&#39;</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">target_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Date range:&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">.</span><span class="n">tdb_strftime</span><span class="p">(),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">.</span><span class="n">tdb_strftime</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Center: 0 SOLAR SYSTEM BARYCENTER
Target: 1 MERCURY BARYCENTER
Date range: 1899-07-29 00:00:00 TDB - 2053-10-09 00:00:00 TDB
</pre></div>
</div>
<p>For example, you can see above
that the first segment of the ephemeris DE421
provides the position of Mercury relative to the center of the Solar System
over the entire twentieth century and half of the twenty-first.</p>
<div class="section" id="making-an-excerpt-of-an-ephemeris">
<h2>Making an excerpt of an ephemeris<a class="headerlink" href="#making-an-excerpt-of-an-ephemeris" title="Permalink to this headline">¶</a></h2>
<p>Several of the ephemeris files listed below are very large.
While most programmers will follow the example above and use DE421,
if you wish to go beyond its 150-year period
you will need a larger ephemeris.
And programmers interested in the moons of Jupiter
will need JUP310, which weighs in at nearly a gigabyte.</p>
<p>What if you need data from a very large ephemeris,
but don’t require its entire time span?</p>
<p>When you installed Skyfield another library named <code class="docutils literal notranslate"><span class="pre">jplephem</span></code>
will have been installed.
When invoked from the command line,
it can build an excerpt of a larger ephemeris
without needing to download the entire file,
thanks to the fact that HTTP supports a <code class="docutils literal notranslate"><span class="pre">Range:</span></code> header
that asks for only specific bytes of a file.
For example,
let’s pull two weeks of data for Jupiter’s moons
(using a shell variable <code class="docutils literal notranslate"><span class="pre">$u</span></code> for the URL
only to make the command less wide here on the screen
and easier to read):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ u=https://naif.jpl.nasa.gov/pub/naif/generic_kernels/spk/satellites/jup310.bsp
$ python -m jplephem excerpt 2018/1/1 2018/1/15 $u jup_excerpt.bsp
</pre></div>
</div>
<p>The resulting file <code class="docutils literal notranslate"><span class="pre">jup_excerpt.bsp</span></code> weighs in
at only 0.2&nbsp;MB instead of 932&nbsp;MB
but supports all of the same objects as the original JUP310
over the given two-week period:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m jplephem spk jup_excerpt.bsp
File type DAF/SPK and format LTL-IEEE with 13 segments:
2458119.75..2458210.50  Jupiter Barycenter (5) -&gt; Io (501)
2458119.50..2458210.50  Jupiter Barycenter (5) -&gt; Europa (502)
2458119.00..2458210.50  Jupiter Barycenter (5) -&gt; Ganymede (503)
2458119.00..2458210.50  Jupiter Barycenter (5) -&gt; Callisto (504)
...
</pre></div>
</div>
<p>You can load and use it directly off of disk
with <a class="reference internal" href="api-iokit.html#skyfield.iokit.load_file" title="skyfield.iokit.load_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_file()</span></code></a>.</p>
</div>
<div class="section" id="popular-ephemerides">
<h2>Popular ephemerides<a class="headerlink" href="#popular-ephemerides" title="Permalink to this headline">¶</a></h2>
<p>Here are several popular ephemerides that you can use with Skyfield.
The filenames matching <code class="docutils literal notranslate"><span class="pre">de*</span></code>
predict the positions of many or all of the major planets,
while <code class="docutils literal notranslate"><span class="pre">jup310.bsp</span></code> focuses on Jupiter and its major moons:</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="14%" />
<col width="30%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ephemeris</th>
<th class="head">Size</th>
<th class="head">Years</th>
<th class="head">Issued</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>de405.bsp</td>
<td>63&nbsp;MB</td>
<td>1600 to 2200</td>
<td>May 1997</td>
</tr>
<tr class="row-odd"><td>de406.bsp</td>
<td>287&nbsp;MB</td>
<td>−3000 to 3000</td>
<td>May 1997</td>
</tr>
<tr class="row-even"><td>de421.bsp</td>
<td>17&nbsp;MB</td>
<td>1900 to 2050</td>
<td>February 2008</td>
</tr>
<tr class="row-odd"><td>de422.bsp</td>
<td>623&nbsp;MB</td>
<td>−3000 to 3000</td>
<td>September 2009</td>
</tr>
<tr class="row-even"><td>de430t.bsp</td>
<td>128&nbsp;MB</td>
<td>1550 to 2650</td>
<td>February 2010</td>
</tr>
<tr class="row-odd"><td>jup310.bsp</td>
<td>932&nbsp;MB</td>
<td>1900 to 2100</td>
<td>December 2013</td>
</tr>
</tbody>
</table>
<p>You can think of negative years, as cited in the above table,
as being almost like years BC except that they are off by one.
Historians invented our calendar back before zero was a counting number,
so AD&nbsp;1 was immediately preceded by 1&nbsp;BC without a year in between.
But astronomers count backwards AD&nbsp;2, AD&nbsp;1, 0, −1, −2, and so forth.</p>
<p>So if you are curious about the positions of the planets back in 44&nbsp;BC,
when Julius Caesar was assassinated,
be careful to ask an astronomer about the year&nbsp;−43 instead.</p>
</div>
<div class="section" id="how-segments-are-linked-to-predict-positions">
<h2>How segments are linked to predict positions<a class="headerlink" href="#how-segments-are-linked-to-predict-positions" title="Permalink to this headline">¶</a></h2>
<p>You can <code class="docutils literal notranslate"><span class="pre">print()</span></code> an ephemeris to learn which objects it supports.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">planets</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPICE kernel file &#39;de421.bsp&#39; has 15 segments
  JD 2414864.50 - JD 2471184.50  (1899-07-28 through 2053-10-08)
      0 -&gt; 1    SOLAR SYSTEM BARYCENTER -&gt; MERCURY BARYCENTER
      0 -&gt; 2    SOLAR SYSTEM BARYCENTER -&gt; VENUS BARYCENTER
      0 -&gt; 3    SOLAR SYSTEM BARYCENTER -&gt; EARTH BARYCENTER
      0 -&gt; 4    SOLAR SYSTEM BARYCENTER -&gt; MARS BARYCENTER
      0 -&gt; 5    SOLAR SYSTEM BARYCENTER -&gt; JUPITER BARYCENTER
      0 -&gt; 6    SOLAR SYSTEM BARYCENTER -&gt; SATURN BARYCENTER
      0 -&gt; 7    SOLAR SYSTEM BARYCENTER -&gt; URANUS BARYCENTER
      0 -&gt; 8    SOLAR SYSTEM BARYCENTER -&gt; NEPTUNE BARYCENTER
      0 -&gt; 9    SOLAR SYSTEM BARYCENTER -&gt; PLUTO BARYCENTER
      0 -&gt; 10   SOLAR SYSTEM BARYCENTER -&gt; SUN
      3 -&gt; 301  EARTH BARYCENTER -&gt; MOON
      3 -&gt; 399  EARTH BARYCENTER -&gt; EARTH
      1 -&gt; 199  MERCURY BARYCENTER -&gt; MERCURY
      2 -&gt; 299  VENUS BARYCENTER -&gt; VENUS
      4 -&gt; 499  MARS BARYCENTER -&gt; MARS
</pre></div>
</div>
<p>Bodies in JPL ephemeris files are each identified by an integer,
but Skyfield translates them so that you do not have to remember
that a code like 399 stands for the Earth and 499 for&nbsp;Mars.</p>
<p>Each ephemeris segment predicts the position of one body
with respect to another.
Sometimes several segments sometimes have to be combined
to generate a complete position.
The DE421 ephemeris shown above, for example,
can produce the position of the Sun directly.
But if you ask it for the position of Earth
then it will have to add together two distances:</p>
<ul class="simple">
<li>From the Solar System’s center&nbsp;(0) to the Earth-Moon barycenter&nbsp;(3)</li>
<li>From the Earth-Moon barycenter&nbsp;(3) to the Earth itself&nbsp;(399)</li>
</ul>
<p>This happens automatically behind the scenes.
All you have to say is <code class="docutils literal notranslate"><span class="pre">planets[399]</span></code> or <code class="docutils literal notranslate"><span class="pre">planets['Earth']</span></code>
and Skyfield will put together a solution using the segments provided.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">earth</span> <span class="o">=</span> <span class="n">planets</span><span class="p">[</span><span class="s1">&#39;earth&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">earth</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Sum of 2 vectors:
 &#39;de421.bsp&#39; segment 0 SOLAR SYSTEM BARYCENTER -&gt; 3 EARTH BARYCENTER
 &#39;de421.bsp&#39; segment 3 EARTH BARYCENTER -&gt; 399 EARTH
</pre></div>
</div>
<p>Each time you ask this <code class="docutils literal notranslate"><span class="pre">earth</span></code> object for its position at a given time,
Skyfield will compute both of these underlying vectors
and add them together to generate the position.</p>
</div>
<div class="section" id="closing-the-file-automatically">
<h2>Closing the file automatically<a class="headerlink" href="#closing-the-file-automatically" title="Permalink to this headline">¶</a></h2>
<p>If you need to close files as you finish using them
instead of waiting until the application exits,
each Skyfield ephemeris offers a
<a class="reference internal" href="api-ephemeris.html#skyfield.jpllib.SpiceKernel.close" title="skyfield.jpllib.SpiceKernel.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code></a> method.
It can either be called manually when you are done with an ephemeris,
or you can use Python’s <a class="reference external" href="https://docs.python.org/3/library/contextlib.html#contextlib.closing"><code class="docutils literal notranslate"><span class="pre">closing()</span></code></a> context manager
to call the method automatically
at the completion of a <code class="docutils literal notranslate"><span class="pre">with</span></code> statement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">closing</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">timescale</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">J2000</span>

<span class="k">with</span> <span class="n">closing</span><span class="p">(</span><span class="n">planets</span><span class="p">):</span>
    <span class="n">planets</span><span class="p">[</span><span class="s1">&#39;venus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># Ephemeris can be used here</span>

<span class="n">planets</span><span class="p">[</span><span class="s1">&#39;venus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># But it’s closed outside the “with”</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  ...
ValueError: seek of closed file
</pre></div>
</div>
</div>
<div class="section" id="type-1-and-type-21-ephemeris-formats">
<span id="third-party-ephemerides"></span><h2>Type 1 and Type 21 ephemeris formats<a class="headerlink" href="#type-1-and-type-21-ephemeris-formats" title="Permalink to this headline">¶</a></h2>
<p>If you generate an ephemeris with a tool like NASA’s
<a class="reference external" href="https://ssd.jpl.nasa.gov/horizons.cgi">HORIZONS</a> system,
it might be in a format not yet natively supported by Skyfield.
The first obstacle to opening the ephemeris
might be its lack of a recognized suffix:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;wld23593.15&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  ...
ValueError: Skyfield does not know how to open a file named &#39;wld23593.15&#39;
</pre></div>
</div>
<p>A workaround for the unusual filename extension
is to open the file manually using Skyfield’s JPL ephemeris support.
The next obstacle, however, will be a lack of support
for Type&nbsp;21 ephemerides in Skyfield:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skyfield.jpllib</span> <span class="kn">import</span> <span class="n">SpiceKernel</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">SpiceKernel</span><span class="p">(</span><span class="s1">&#39;wld23593.15&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  ...
ValueError: SPK data type 21 not yet supported
</pre></div>
</div>
<p>Older files with a similar format
might instead generate the complaint
“SPK data type&nbsp;1 not yet supported.”</p>
<p>Happily, thanks to Shushi Uetsuki,
a pair of third-party libraries exist
that offer preliminary support for Type&nbsp;1 and Type&nbsp;21 ephemerides!</p>
<ul class="simple">
<li><a class="reference external" href="https://pypi.org/project/spktype01/">https://pypi.org/project/spktype01/</a></li>
<li><a class="reference external" href="https://pypi.org/project/spktype21/">https://pypi.org/project/spktype21/</a></li>
</ul>
<p>Their documentation already includes examples of generating raw coordinates,
but many Skyfield users will want to use them
in conjunction with standard Skyfield methods like <code class="docutils literal notranslate"><span class="pre">observe()</span></code>.
To integrate them with the rest of Skyfield,
you will want to define a new vector function class
that calls the third-party module to generate coordinates:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skyfield.constants</span> <span class="kn">import</span> <span class="n">AU_KM</span>
<span class="kn">from</span> <span class="nn">skyfield.vectorlib</span> <span class="kn">import</span> <span class="n">VectorFunction</span>
<span class="kn">from</span> <span class="nn">spktype21</span> <span class="kn">import</span> <span class="n">SPKType21</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="n">eph</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s1">&#39;de421.bsp&#39;</span><span class="p">)</span>
<span class="n">earth</span> <span class="o">=</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;earth&#39;</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Type21Object</span><span class="p">(</span><span class="n">VectorFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>

    <span class="k">def</span> <span class="nf">_at</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">compute_type21</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">whole</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">tdb_fraction</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span> <span class="o">/</span> <span class="n">AU_KM</span><span class="p">,</span> <span class="n">v</span> <span class="o">/</span> <span class="n">AU_KM</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

<span class="n">kernel</span> <span class="o">=</span> <span class="n">SPKType21</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;wld23593.15&#39;</span><span class="p">)</span>
<span class="n">chiron</span> <span class="o">=</span> <span class="n">Type21Object</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="mi">2002060</span><span class="p">)</span>

<span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">chiron</span><span class="p">)</span><span class="o">.</span><span class="n">radec</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>00h 27m 38.99s
+05deg 57&#39; 08.9&quot;
</pre></div>
</div>
<p>Hopefully this third-party support
for Type&nbsp;1 and Type&nbsp;23 SPK ephemeris segments
will be sufficient for projects that need them,
until there is time for a Skyfield contributor
to integrate such support into Skyfield itself.</p>
</div>
</div>

  </body>
</html>