<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Almanac Computation — Skyfield documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/style.css">
  </head>
  <body>
    
    <p class="motto">
      <b>Skyfield:</b>
      <a href=".">Home</a>
      •
      <a href="toc.html">Table of Contents</a>
      •
      <a href="installation.html#changelog">Changelog</a>
      •
      <a href="api.html">API Reference</a>
    </p>
    
    <div class="section" id="almanac-computation">
<h1>Almanac Computation<a class="headerlink" href="#almanac-computation" title="Permalink to this headline">¶</a></h1>
<p>To help you navigate, here are the topics covered on this page:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#rounding-time-to-the-nearest-minute" id="id4">Rounding time to the nearest minute</a></li>
<li><a class="reference internal" href="#risings-and-settings" id="id5">Risings and settings</a><ul>
<li><a class="reference internal" href="#sunrise-and-sunset" id="id6">Sunrise and Sunset</a></li>
<li><a class="reference internal" href="#detecting-polar-day-and-polar-night" id="id7">Detecting polar day and polar night</a></li>
<li><a class="reference internal" href="#moonrise-and-moonset" id="id8">Moonrise and moonset</a></li>
<li><a class="reference internal" href="#planet-rising-and-setting" id="id9">Planet rising and setting</a></li>
<li><a class="reference internal" href="#computing-your-own-refraction-angle" id="id10">Computing your own refraction angle</a></li>
<li><a class="reference internal" href="#elevated-vantage-points" id="id11">Elevated vantage points</a></li>
<li><a class="reference internal" href="#when-a-right-ascension-and-declination-rises-and-sets" id="id12">When a right ascension and declination rises and sets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-seasons" id="id13">The Seasons</a></li>
<li><a class="reference internal" href="#phases-of-the-moon" id="id14">Phases of the Moon</a></li>
<li><a class="reference internal" href="#lunar-nodes" id="id15">Lunar Nodes</a></li>
<li><a class="reference internal" href="#opposition-and-conjunction" id="id16">Opposition and Conjunction</a></li>
<li><a class="reference internal" href="#meridian-transits" id="id17">Meridian Transits</a></li>
<li><a class="reference internal" href="#legacy-transit-routine" id="id18">Legacy transit routine</a></li>
<li><a class="reference internal" href="#legacy-rising-and-setting-routines" id="id19">Legacy rising and setting routines</a></li>
<li><a class="reference internal" href="#twilight" id="id20">Twilight</a></li>
<li><a class="reference internal" href="#solar-terms" id="id21">Solar terms</a></li>
<li><a class="reference internal" href="#lunar-eclipses" id="id22">Lunar eclipses</a></li>
</ul>
</div>
<p>Here are the imports and objects that will drive the examples below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skyfield</span> <span class="kn">import</span> <span class="n">almanac</span>
<span class="kn">from</span> <span class="nn">skyfield.api</span> <span class="kn">import</span> <span class="n">N</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="n">wgs84</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">timescale</span><span class="p">()</span>
<span class="n">eph</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s1">&#39;de421.bsp&#39;</span><span class="p">)</span>
<span class="n">sun</span> <span class="o">=</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">]</span>
<span class="n">bluffton</span> <span class="o">=</span> <span class="n">wgs84</span><span class="o">.</span><span class="n">latlon</span><span class="p">(</span><span class="mf">40.8939</span> <span class="o">*</span> <span class="n">N</span><span class="p">,</span> <span class="mf">83.8917</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span>
<span class="n">observer</span> <span class="o">=</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;Earth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bluffton</span>
</pre></div>
</div>
<p>Note a distinction:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">bluffton</span></code> — this <a class="reference internal" href="api-topos.html#skyfield.toposlib.GeographicPosition" title="skyfield.toposlib.GeographicPosition"><code class="xref py py-class docutils literal notranslate"><span class="pre">GeographicPosition</span></code></a>
computes the vector from the Earth’s center
to a specific geographic location.
Unless an elevation is specified,
the vector’s length will be the Earth’s radius,
which varies from 6,357&nbsp;km at the pole to 6,378&nbsp;km at the equator.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">observer</span></code> — this computes the much larger vector
from the center of the Solar System to the geographic position.</p>
<p>Almanac routines typically need to be passed this full vector,
not merely a geographic position.
Depending on the season (Earth is closest to the Sun in early January),
it will be somewhere close to 1&nbsp;au in length.</p>
</li>
</ul>
<p>Beware that almanac computation can be expensive.
As almanac routines search backwards and forwards through time
for particular circumstances,
they have to repeatedly recompute
the positions of the Earth and other bodies.</p>
<div class="section" id="rounding-time-to-the-nearest-minute">
<h2><a class="toc-backref" href="#id4">Rounding time to the nearest minute</a><a class="headerlink" href="#rounding-time-to-the-nearest-minute" title="Permalink to this headline">¶</a></h2>
<p>If you compare almanac results to official sources like the <a class="reference external" href="https://aa.usno.navy.mil/data/index">United
States Naval Observatory</a>, the
printed time will often differ because the Naval Observatory results are
rounded to the nearest minute — any time with <code class="docutils literal notranslate"><span class="pre">:30</span></code> or more seconds at
the end gets rounded up to the next minute.</p>
<p>The Skyfield method <a class="reference internal" href="api-time.html#skyfield.timelib.Time.utc_strftime" title="skyfield.timelib.Time.utc_strftime"><code class="xref py py-meth docutils literal notranslate"><span class="pre">utc_strftime()</span></code></a>
performs this rounding automatically if you don’t ask for the seconds to
be displayed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mf">45.9</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Microseconds:&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">utc_strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nearest second:&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">utc_strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nearest minute:&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">utc_strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Microseconds: 2023-08-10 06:21:45.900000
Nearest second: 2023-08-10 06:21:46
Nearest minute: 2023-08-10 06:22
</pre></div>
</div>
<p>But beware that the rounding won’t happen automatically if you are doing
your own formatting using Python’s built-in <code class="docutils literal notranslate"><span class="pre">datetime</span></code> objects.  For
example, if you stop with <code class="docutils literal notranslate"><span class="pre">%M</span></code>, then the seconds are simply ignored,
instead of being used for rounding:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">utc_datetime</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2023-08-10 06:21
</pre></div>
</div>
<p>To fix the problem and round a Python <code class="docutils literal notranslate"><span class="pre">datetime</span></code> to the nearest
minute, try manually adding 30&nbsp;seconds to the time before displaying it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>

<span class="k">def</span> <span class="nf">nearest_minute</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">dt</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">nearest_minute</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">utc_datetime</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2023-08-10 06:22
</pre></div>
</div>
<p>The results should then agree with the tables produced by the USNO.</p>
</div>
<div class="section" id="risings-and-settings">
<span id="id1"></span><h2><a class="toc-backref" href="#id5">Risings and settings</a><a class="headerlink" href="#risings-and-settings" title="Permalink to this headline">¶</a></h2>
<p>Skyfield can compute when a given body rises and sets
for an observer at the Earth’s surface.
The routines are designed for bodies
at least as far away as Moon,
that rise and set about once a day,
so it will be caught off-guard
if you pass it something fast like an Earth satellite.
For that case, see <a class="reference internal" href="earth-satellites.html#satellite-rising-and-setting"><span class="std std-ref">Finding when a satellite rises and sets</span></a>.</p>
<div class="section" id="sunrise-and-sunset">
<h3><a class="toc-backref" href="#id6">Sunrise and Sunset</a><a class="headerlink" href="#sunrise-and-sunset" title="Permalink to this headline">¶</a></h3>
<p>Skyfield uses the
<a class="reference external" href="https://aa.usno.navy.mil/faq/RST_defs">official definition of sunrise and sunset</a>
from the United States Naval Observatory,
which defines them as the moment when the center
of the sun is 50&nbsp;arcminutes below the horizon,
to account for both the average solar radius of 16&nbsp;arcminutes
and for roughly 34&nbsp;arcminutes of atmospheric refraction at the horizon.
Here’s how to ask for the sunrises between a given start and end time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_risings</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">sun</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;2018-09-12 11:13:12Z&#39;, &#39;2018-09-13 11:14:12Z&#39;]
[ True  True]
</pre></div>
</div>
<p>And here’s how to ask for the sunsets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_settings</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">sun</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;2018-09-12 23:49:38Z&#39;, &#39;2018-09-13 23:47:56Z&#39;]
[ True  True]
</pre></div>
</div>
<p>Normally every value in the second array will be <code class="docutils literal notranslate"><span class="pre">True</span></code>,
indicating that a rising or setting was successfully detected.
See the next section for an example where the value is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div>
<div class="section" id="detecting-polar-day-and-polar-night">
<span id="polar-day-and-night"></span><h3><a class="toc-backref" href="#id7">Detecting polar day and polar night</a><a class="headerlink" href="#detecting-polar-day-and-polar-night" title="Permalink to this headline">¶</a></h3>
<p>In the Arctic and Antarctic,
there will be summer days when the sun never sets,
and winter days when the sun never rises.
On such days the second array returned by the rising and setting routines
will have the value <code class="docutils literal notranslate"><span class="pre">False</span></code> instead of <code class="docutils literal notranslate"><span class="pre">True</span></code>.
The time returned will instead be that of transit,
whether that takes place above or below the horizon.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">harra_sweden</span> <span class="o">=</span> <span class="n">wgs84</span><span class="o">.</span><span class="n">latlon</span><span class="p">(</span><span class="mf">67.4066</span> <span class="o">*</span> <span class="n">N</span><span class="p">,</span> <span class="mf">20.0997</span> <span class="o">*</span> <span class="n">E</span><span class="p">)</span>
<span class="n">harra_observer</span> <span class="o">=</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;Earth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">harra_sweden</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_risings</span><span class="p">(</span><span class="n">harra_observer</span><span class="p">,</span> <span class="n">sun</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>

<span class="n">alt</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">harra_observer</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">sun</span><span class="p">)</span><span class="o">.</span><span class="n">apparent</span><span class="p">()</span><span class="o">.</span><span class="n">altaz</span><span class="p">()</span>

<span class="k">for</span> <span class="n">ti</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">alti</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">degrees</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{:5}</span><span class="s1"> </span><span class="si">{:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">yi</span><span class="p">),</span> <span class="n">alti</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2022-12-18 10:22:54Z True  -0.8333
2022-12-19 10:29:21Z True  -0.8333
2022-12-20 10:37:06Z False -0.8387
2022-12-21 10:37:36Z False -0.8464
2022-12-22 10:38:06Z False -0.8461
2022-12-23 10:38:36Z False -0.8380
2022-12-24 10:31:28Z True  -0.8333
2022-12-25 10:26:08Z True  -0.8333
</pre></div>
</div>
<p>This output shows that right around the winter solstice,
there are four days on which the Sun never quite reaches the horizon,
but is at least a few fractions of a degree below the altitude of -0.8333°
that would qualify for the USNO definition of sunrise.
So Skyfield instead returns the moment when the Sun is closest to the horizon,
with the accompanying value <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div>
<div class="section" id="moonrise-and-moonset">
<h3><a class="toc-backref" href="#id8">Moonrise and moonset</a><a class="headerlink" href="#moonrise-and-moonset" title="Permalink to this headline">¶</a></h3>
<p>Skyfield uses the
<a class="reference external" href="https://aa.usno.navy.mil/faq/RST_defs">official definition of moonrise and moonset</a>
from the United States Naval Observatory:
the moment when the top edge of the Moon
is exactly 34&nbsp;arcminutes below the horizon,
to correct for atmospheric refraction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">moon</span> <span class="o">=</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;Moon&#39;</span><span class="p">]</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">29</span><span class="p">)</span>

<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_risings</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">moon</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Moonrises (UTC):&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>

<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_settings</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">moon</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Moonsets (UTC):&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Moonrises (UTC): [&#39;2023-12-27 22:40:11Z&#39;, &#39;2023-12-28 23:43:48Z&#39;]
Moonsets (UTC): [&#39;2023-12-27 13:54:47Z&#39;, &#39;2023-12-28 14:39:33Z&#39;]
</pre></div>
</div>
<p>Read the previous section to learn about the Boolean array <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
</div>
<div class="section" id="planet-rising-and-setting">
<h3><a class="toc-backref" href="#id9">Planet rising and setting</a><a class="headerlink" href="#planet-rising-and-setting" title="Permalink to this headline">¶</a></h3>
<p>The rising and setting routines also work for planets.
To account for atmospheric refraction under typical conditions,
Skyfield will look for the moment
when the center of the planet’s disc
is exactly 34&nbsp;arcminutes below the horizon.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_risings</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;Mars&#39;</span><span class="p">],</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mars rises:&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>

<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_settings</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;Mars&#39;</span><span class="p">],</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mars sets: &#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Mars rises: [&#39;2020-02-01 09:29:16Z&#39;, &#39;2020-02-02 09:28:34Z&#39;]
Mars sets:  [&#39;2020-02-01 18:42:57Z&#39;, &#39;2020-02-02 18:41:41Z&#39;]
</pre></div>
</div>
<p>Read the previous section <a class="reference internal" href="#polar-day-and-night"><span class="std std-ref">Detecting polar day and polar night</span></a>
to learn about the Boolean array <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
</div>
<div class="section" id="computing-your-own-refraction-angle">
<span id="horizon-degrees"></span><h3><a class="toc-backref" href="#id10">Computing your own refraction angle</a><a class="headerlink" href="#computing-your-own-refraction-angle" title="Permalink to this headline">¶</a></h3>
<p>Atmospheric refraction makes bodies at the horizon
appear slightly higher than they would be otherwise.
That’s why Skyfield doesn’t wait until a body’s altazimuth coordinates
have reached 0.0° altitude
to proclaim that it has risen.
Instead, as explained in the previous sections,
Skyfield goes ahead and counts a body as risen
as soon as it has reached −0°34′ altitude.</p>
<p>But refraction varies with atmospheric conditions.
To supply your own estimate
of the altitude of the visible horizon,
pass the optional <code class="docutils literal notranslate"><span class="pre">horizon_degrees</span></code> argument
to <a class="reference internal" href="api-almanac.html#skyfield.almanac.find_risings" title="skyfield.almanac.find_risings"><code class="xref py py-func docutils literal notranslate"><span class="pre">find_risings()</span></code></a>
and <a class="reference internal" href="api-almanac.html#skyfield.almanac.find_settings" title="skyfield.almanac.find_settings"><code class="xref py py-func docutils literal notranslate"><span class="pre">find_settings()</span></code></a>
with the target altitude angle you want to use instead.</p>
<p>To help you build an estimate,
Skyfield provides a small function
that takes an altitude angle, the temperature, and the pressure,
and returns a standard United States Naval Observatory estimate
for the angle of atmospheric refraction.
Here’s an example of how to use it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skyfield.earthlib</span> <span class="kn">import</span> <span class="n">refraction</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">refraction</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">temperature_C</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">pressure_mbar</span><span class="o">=</span><span class="mf">1030.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Refraction at the horizon: </span><span class="si">%.2f</span><span class="s1"> arcminutes</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="mf">60.0</span><span class="p">))</span>

<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_risings</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;Mars&#39;</span><span class="p">],</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span>
                            <span class="n">horizon_degrees</span><span class="o">=-</span><span class="n">r</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mars rises:&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>

<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_settings</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;Mars&#39;</span><span class="p">],</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span>
                             <span class="n">horizon_degrees</span><span class="o">=-</span><span class="n">r</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mars sets: &#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Refraction at the horizon: 34.53 arcminutes

Mars rises: [&#39;2020-02-01 09:29:13Z&#39;, &#39;2020-02-02 09:28:30Z&#39;]
Mars sets:  [&#39;2020-02-01 18:43:00Z&#39;, &#39;2020-02-02 18:41:45Z&#39;]
</pre></div>
</div>
<p>If you want to account for both atmospheric refraction
and also the radius of the target body,
then simply supply an even more negative value for <code class="docutils literal notranslate"><span class="pre">horizon_degrees</span></code>
that combines the correction for refraction
with the radius of the body’s visible disc in the sky.</p>
</div>
<div class="section" id="elevated-vantage-points">
<h3><a class="toc-backref" href="#id11">Elevated vantage points</a><a class="headerlink" href="#elevated-vantage-points" title="Permalink to this headline">¶</a></h3>
<p>Rising and setting predictions usually assume a flat local horizon
that does not vary with elevation.
Yes, Denver is the Mile High City,
but it sees the sun rise against a local horizon that’s also a mile high.
Since the city’s high elevation
is matched by the high elevation of the terrain around it,
the horizon winds up in the same place it would be for a city at sea level.</p>
<p>But sometimes you need to account for a viewpoint’s
local prominence above the surrounding terrain.
Some observatories, for example, are located on mountaintops
that are much higher than the terrain that forms their horizon.
And Earth satellites can be hundreds of kilometers
above the surface of the Earth that produces their sunrises and sunsets.</p>
<p>You can account for an observer’s prominence above their horizon’s terrain
by setting an artificially negative value for <code class="docutils literal notranslate"><span class="pre">horizon_degrees</span></code>.
If we consider the Earth to be approximately a sphere,
then we can use a bit of trigonometry
to estimate the position of the horizon for an observer at altitude:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">arccos</span>
<span class="kn">from</span> <span class="nn">skyfield.units</span> <span class="kn">import</span> <span class="n">Angle</span>

<span class="c1"># When does the Sun rise in the ionosphere’s F-layer, 300km up?</span>

<span class="n">altitude_m</span> <span class="o">=</span> <span class="mf">300e3</span>
<span class="n">earth_radius_m</span> <span class="o">=</span> <span class="mf">6378136.6</span>
<span class="n">side_over_hypotenuse</span> <span class="o">=</span> <span class="n">earth_radius_m</span> <span class="o">/</span> <span class="p">(</span><span class="n">earth_radius_m</span> <span class="o">+</span> <span class="n">altitude_m</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">radians</span> <span class="o">=</span> <span class="o">-</span><span class="n">arccos</span><span class="p">(</span><span class="n">side_over_hypotenuse</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The horizon from 300km up is at </span><span class="si">%.2f</span><span class="s1"> degrees&#39;</span> <span class="o">%</span> <span class="n">h</span><span class="o">.</span><span class="n">degrees</span><span class="p">)</span>

<span class="n">solar_radius_degrees</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_risings</span><span class="p">(</span>
    <span class="n">observer</span><span class="p">,</span> <span class="n">sun</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span>
    <span class="n">horizon_degrees</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">degrees</span> <span class="o">-</span> <span class="n">solar_radius_degrees</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;At&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="s1">&#39;the limb of the Sun crests the horizon&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The horizon from 300km up is at -17.24 degrees
At 2020-02-01 11:14:57Z the limb of the Sun crests the horizon
</pre></div>
</div>
<p>Beware a possible source of confusion:
some people use the word <em>altitude</em>
for a geographic site’s elevation in meters above sea level.
And other people — primarily Earth satellite folks —
use the term <em>elevation</em>
for degrees above or below the horizon,
which Skyfield instead calls <em>altitude</em>
(because that’s what the syllable <em>alt-</em> stands for
in the name <em>altazimuth coordinate system</em>).</p>
</div>
<div class="section" id="when-a-right-ascension-and-declination-rises-and-sets">
<h3><a class="toc-backref" href="#id12">When a right ascension and declination rises and sets</a><a class="headerlink" href="#when-a-right-ascension-and-declination-rises-and-sets" title="Permalink to this headline">¶</a></h3>
<p>If you are interested in finding the times
when a fixed point in the sky rises and sets,
simply create a star object with the coordinates
of the position you are interested in
(see <a class="reference internal" href="stars.html"><span class="doc">Stars and Distant Objects</span></a>)
and then call the routines described above.
Here, for example, is the rising time for the Galactic Center:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skyfield.api</span> <span class="kn">import</span> <span class="n">Star</span>

<span class="n">galactic_center</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="n">ra_hours</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mf">40.04</span><span class="p">),</span>
                       <span class="n">dec_degrees</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">29</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">28.1</span><span class="p">))</span>

<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_risings</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">galactic_center</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The Galactic Center rises at&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The Galactic Center rises at 2020-02-01 10:29:00Z
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-seasons">
<h2><a class="toc-backref" href="#id13">The Seasons</a><a class="headerlink" href="#the-seasons" title="Permalink to this headline">¶</a></h2>
<p>Create a start time and an end time to ask for all of the equinoxes and
solstices that fall in between.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_discrete</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">almanac</span><span class="o">.</span><span class="n">seasons</span><span class="p">(</span><span class="n">eph</span><span class="p">))</span>

<span class="k">for</span> <span class="n">yi</span><span class="p">,</span> <span class="n">ti</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span> <span class="n">almanac</span><span class="o">.</span><span class="n">SEASON_EVENTS</span><span class="p">[</span><span class="n">yi</span><span class="p">],</span> <span class="n">ti</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0 Vernal Equinox 2018-03-20 16:15:27Z
1 Summer Solstice 2018-06-21 10:07:18Z
2 Autumnal Equinox 2018-09-23 01:54:06Z
3 Winter Solstice 2018-12-21 22:22:44Z
</pre></div>
</div>
<p>The result <code class="docutils literal notranslate"><span class="pre">t</span></code> will be an array of times, and <code class="docutils literal notranslate"><span class="pre">y</span></code> will be <code class="docutils literal notranslate"><span class="pre">0</span></code>
through <code class="docutils literal notranslate"><span class="pre">3</span></code> for the Vernal Equinox through the Winter Solstice.</p>
<p>If you or some of your users live in the Southern Hemisphere,
you can use the <code class="docutils literal notranslate"><span class="pre">SEASON_EVENTS_NEUTRAL</span></code> array.
Instead of naming specific seasons,
it names the equinoxes and solstices by the month in which they occur —
so the <code class="docutils literal notranslate"><span class="pre">March</span> <span class="pre">Equinox</span></code>, for example, is followed by the <code class="docutils literal notranslate"><span class="pre">June</span> <span class="pre">Solstice</span></code>.</p>
</div>
<div class="section" id="phases-of-the-moon">
<h2><a class="toc-backref" href="#id14">Phases of the Moon</a><a class="headerlink" href="#phases-of-the-moon" title="Permalink to this headline">¶</a></h2>
<p>The phases of the Moon are the same for everyone on Earth,
so you don’t need to specify the longitude and latitude of your location.
Simply ask for the current phase of the Moon.
The return value is an angle
where 0° is New Moon, 90° is First Quarter,
180° is Full Moon, and 270° is Last Quarter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
<span class="n">phase</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">moon_phase</span><span class="p">(</span><span class="n">eph</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Moon phase: </span><span class="si">{:.1f}</span><span class="s1"> degrees&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phase</span><span class="o">.</span><span class="n">degrees</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Moon phase: 51.3 degrees
</pre></div>
</div>
<p>Or you can have Skyfield search over a range of dates for the moments
when the Moon reaches First Quarter, Full Moon, Last Quarter, and New Moon:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_discrete</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">almanac</span><span class="o">.</span><span class="n">moon_phases</span><span class="p">(</span><span class="n">eph</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">almanac</span><span class="o">.</span><span class="n">MOON_PHASES</span><span class="p">[</span><span class="n">yi</span><span class="p">]</span> <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="n">y</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;2018-09-03T02:37:24Z&#39;, &#39;2018-09-09T18:01:28Z&#39;]
[3 0]
[&#39;Last Quarter&#39;, &#39;New Moon&#39;]
</pre></div>
</div>
<p>The result <code class="docutils literal notranslate"><span class="pre">t</span></code> will be an array of times, and <code class="docutils literal notranslate"><span class="pre">y</span></code> will be a
corresponding array of Moon phases with 0 for New Moon and 3 for Last
Quarter.  You can use the array <code class="docutils literal notranslate"><span class="pre">MOON_PHASES</span></code> to retrieve names for
each phase.</p>
</div>
<div class="section" id="lunar-nodes">
<span id="id2"></span><h2><a class="toc-backref" href="#id15">Lunar Nodes</a><a class="headerlink" href="#lunar-nodes" title="Permalink to this headline">¶</a></h2>
<p>The Moon’s ascending node and descending node are the moments each lunar
month when the Moon crosses the plane of Earth’s orbit and eclipses are
possible.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_discrete</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">almanac</span><span class="o">.</span><span class="n">moon_nodes</span><span class="p">(</span><span class="n">eph</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">almanac</span><span class="o">.</span><span class="n">MOON_NODES</span><span class="p">[</span><span class="n">yi</span><span class="p">]</span> <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="n">y</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;2020-04-27T17:54:17Z&#39;, &#39;2020-05-10T09:01:42Z&#39;]
[1 0]
[&#39;ascending&#39;, &#39;descending&#39;]
</pre></div>
</div>
</div>
<div class="section" id="opposition-and-conjunction">
<span id="oppositions-conjunctions"></span><h2><a class="toc-backref" href="#id16">Opposition and Conjunction</a><a class="headerlink" href="#opposition-and-conjunction" title="Permalink to this headline">¶</a></h2>
<p>The moment at which a planet is in opposition with the Sun or in
conjunction with the Sun is when their ecliptic longitudes are at 0° or
180° difference.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">oppositions_conjunctions</span><span class="p">(</span><span class="n">eph</span><span class="p">,</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;mars&#39;</span><span class="p">])</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_discrete</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;2019-09-02T10:42:26Z&#39;, &#39;2020-10-13T23:25:55Z&#39;]
[0 1]
</pre></div>
</div>
<p>The result <code class="docutils literal notranslate"><span class="pre">t</span></code> will be an array of times, and <code class="docutils literal notranslate"><span class="pre">y</span></code> will be an array
of integers indicating which half of the sky the body has just entered:
0 means the half of the sky west of the Sun along the ecliptic, and 1
means the half of the sky east of the Sun.  This means different things
for different bodies:</p>
<ul class="simple">
<li>For the outer planets Mars, Jupiter, Saturn, Uranus, and all other
bodies out beyond our orbit, 0 means the moment of conjunction with
the Sun and 1 means the moment of opposition.</li>
<li>Because the Moon moves eastward across our sky relative to the Sun,
not westward, the output is reversed compared to the outer planets: 0
means the moment of opposition or Full Moon, while 1 means the moment
of conjunction or New Moon.</li>
<li>The inner planets Mercury and Venus only ever experience conjunctions
with the Sun from our point of view, never oppositions, with 0
indicating an inferior conjunction and 1 a superior conjunction.</li>
</ul>
</div>
<div class="section" id="meridian-transits">
<span id="transits"></span><h2><a class="toc-backref" href="#id17">Meridian Transits</a><a class="headerlink" href="#meridian-transits" title="Permalink to this headline">¶</a></h2>
<p>Every day the Earth’s rotation
swings the sky through nearly 360°,
leaving the celestial poles stationary
while bringing each star and planet in turn
across your <em>meridian</em> —
the line of right ascension in the sky above you
that runs from the South Pole to the North Pole through your local zenith.</p>
<p>You can ask Skyfield for the times at which a body
crosses your meridian:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_transits</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;Mars&#39;</span><span class="p">],</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">utc_strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;2020-11-06 03:32&#39;, &#39;2020-11-07 03:28&#39;]
</pre></div>
</div>
<p>Observers often think of transit as the moment
when an object is highest in the sky,
but that’s only roughly true.
At very high precision,
if the body has any north or south velocity
then its moment of highest altitude will be slightly earlier or later.</p>
<p>Bodies near the poles are exceptions to the general rule
that a body is visible at transit but below the horizon at antitransit.
For a body that’s circumpolar from your location,
transit and antitransit are both moments of visibility,
when it stands above and below the pole.
And objects close to the opposite pole will always be below the horizon,
even as they invisibly transit your line of longitude
down below your horizon.</p>
</div>
<div class="section" id="legacy-transit-routine">
<h2><a class="toc-backref" href="#id18">Legacy transit routine</a><a class="headerlink" href="#legacy-transit-routine" title="Permalink to this headline">¶</a></h2>
<p>Skyfield has an older mechanism for detecting transits
that isn’t as fast as the function described in the previous section,
but it also returns the moments of anti-transit,
when a body crosses the line of right ascension that crosses your local nadir:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">meridian_transits</span><span class="p">(</span><span class="n">eph</span><span class="p">,</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;Mars&#39;</span><span class="p">],</span> <span class="n">bluffton</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_discrete</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">utc_strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">almanac</span><span class="o">.</span><span class="n">MERIDIAN_TRANSITS</span><span class="p">[</span><span class="n">yi</span><span class="p">]</span> <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="n">y</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;2020-11-06 03:32&#39;, &#39;2020-11-06 15:30&#39;]
[1 0]
[&#39;Meridian transit&#39;, &#39;Antimeridian transit&#39;]
</pre></div>
</div>
<p>Some astronomers call these moments
“upper culmination” and “lower culmination” instead.</p>
</div>
<div class="section" id="legacy-rising-and-setting-routines">
<h2><a class="toc-backref" href="#id19">Legacy rising and setting routines</a><a class="headerlink" href="#legacy-rising-and-setting-routines" title="Permalink to this headline">¶</a></h2>
<p>In case you are maintaining older code,
versions of Skyfield before&nbsp;1.47
could only compute sunrises and sunsets
with a routine that was much slower than the functions described above.
It also tended to miss sunrises and sunsets in the Arctic and Antarctic.
Here’s how it was called:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">sunrise_sunset</span><span class="p">(</span><span class="n">eph</span><span class="p">,</span> <span class="n">bluffton</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_discrete</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;2020-11-06T12:12:46Z&#39;, &#39;2020-11-06T22:25:10Z&#39;]
[1 0]
</pre></div>
</div>
<p>The result <code class="docutils literal notranslate"><span class="pre">t</span></code> will be an array of times, and <code class="docutils literal notranslate"><span class="pre">y</span></code> will be <code class="docutils literal notranslate"><span class="pre">1</span></code> if
the sun rises at the corresponding time and <code class="docutils literal notranslate"><span class="pre">0</span></code> if it sets.</p>
<p>Another old routine <a class="reference internal" href="api-almanac.html#skyfield.almanac.risings_and_settings" title="skyfield.almanac.risings_and_settings"><code class="xref py py-func docutils literal notranslate"><span class="pre">risings_and_settings()</span></code></a>
worked the same way, but for general targets like planets.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">risings_and_settings</span><span class="p">(</span><span class="n">eph</span><span class="p">,</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;Mars&#39;</span><span class="p">],</span> <span class="n">bluffton</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_discrete</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;2020-11-06T09:50:55Z&#39;, &#39;2020-11-06T21:08:55Z&#39;]
[0 1]
</pre></div>
</div>
</div>
<div class="section" id="twilight">
<h2><a class="toc-backref" href="#id20">Twilight</a><a class="headerlink" href="#twilight" title="Permalink to this headline">¶</a></h2>
<p>The routine <a class="reference internal" href="api-almanac.html#skyfield.almanac.dark_twilight_day" title="skyfield.almanac.dark_twilight_day"><code class="xref py py-func docutils literal notranslate"><span class="pre">dark_twilight_day()</span></code></a>
returns a separate code for each of the phases of twilight:</p>
<ol class="arabic simple" start="0">
<li>Dark of night.</li>
<li>Astronomical twilight.</li>
<li>Nautical twilight.</li>
<li>Civil twilight.</li>
<li>Daytime.</li>
</ol>
<p>You can find a full example of its use
at the <a class="reference internal" href="examples.html#dark-twilight-day-example"><span class="std std-ref">When will it get dark tonight?</span></a>.</p>
</div>
<div class="section" id="solar-terms">
<h2><a class="toc-backref" href="#id21">Solar terms</a><a class="headerlink" href="#solar-terms" title="Permalink to this headline">¶</a></h2>
<p>The solar terms are widely used in East Asian calendars.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skyfield</span> <span class="kn">import</span> <span class="n">almanac_east_asia</span> <span class="k">as</span> <span class="n">almanac_ea</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">tm</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_discrete</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">almanac_ea</span><span class="o">.</span><span class="n">solar_terms</span><span class="p">(</span><span class="n">eph</span><span class="p">))</span>

<span class="k">for</span> <span class="n">tmi</span><span class="p">,</span> <span class="n">ti</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tm</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tmi</span><span class="p">,</span> <span class="n">almanac_ea</span><span class="o">.</span><span class="n">SOLAR_TERMS_ZHS</span><span class="p">[</span><span class="n">tmi</span><span class="p">],</span> <span class="n">ti</span><span class="o">.</span><span class="n">utc_iso</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>17 大雪 2019-12-07 10:18:28Z
18 冬至 2019-12-22 04:19:26Z
</pre></div>
</div>
<p>The result <code class="docutils literal notranslate"><span class="pre">t</span></code> will be an array of times, and <code class="docutils literal notranslate"><span class="pre">y</span></code> will be integers
in the range 0–23 which are each the index of a solar term.  Localized
names for the solar terms in different East Asia languages are provided
as <code class="docutils literal notranslate"><span class="pre">SOLAR_TERMS_JP</span></code> for Japanese, <code class="docutils literal notranslate"><span class="pre">SOLAR_TERMS_VN</span></code> for Vietnamese,
<code class="docutils literal notranslate"><span class="pre">SOLAR_TERMS_ZHT</span></code> for Traditional Chinese, and (as shown above)
<code class="docutils literal notranslate"><span class="pre">SOLAR_TERMS_ZHS</span></code> for Simplified Chinese.</p>
</div>
<div class="section" id="lunar-eclipses">
<span id="id3"></span><h2><a class="toc-backref" href="#id22">Lunar eclipses</a><a class="headerlink" href="#lunar-eclipses" title="Permalink to this headline">¶</a></h2>
<p>Skyfield can find the dates of lunar eclipses.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skyfield</span> <span class="kn">import</span> <span class="n">eclipselib</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">details</span> <span class="o">=</span> <span class="n">eclipselib</span><span class="o">.</span><span class="n">lunar_eclipses</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">eph</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ti</span><span class="p">,</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">utc_strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">),</span>
          <span class="s1">&#39;y=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">yi</span><span class="p">),</span>
          <span class="n">eclipselib</span><span class="o">.</span><span class="n">LUNAR_ECLIPSES</span><span class="p">[</span><span class="n">yi</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2019-01-21 05:12 y=2 Total
2019-07-16 21:31 y=1 Partial
</pre></div>
</div>
<p>Note that any eclipse forecast
is forced to make arbitrary distinctions
when eclipses fall very close to the boundary
between the categories “partial”, “penumbral”, and “total”.
Skyfield searches for lunar eclipses using the techniques described
in the <em>Explanatory Supplement to the Astronomical Almanac.</em>
Here is its current behavior:</p>
<ul class="simple">
<li>Skyfield currently finds every one of the 3,642 lunar eclipses
listed for the years AD&nbsp;1000–2500
in NASA’s
<a class="reference external" href="https://eclipse.gsfc.nasa.gov/SEpubs/5MCLE.html">Five Millennium Canon of Lunar Eclipses</a>
by Espenak and Meeus.</li>
<li>But some slight disagreements are inevitable,
because Skyfield uses a modern ephemeris for Earth and Moon positions,
while the <em>Supplement</em> used the old VSOP87 theory.
In 8&nbsp;cases over the years AD&nbsp;1000–2500 (around 0.2% of the eclipses listed),
Skyfield disagrees with the <em>Canon</em>
about whether an eclipse was partial or total.
And on 1571&nbsp;July&nbsp;7 Skyfield finds an eclipse,
but the <em>Canon</em> judges the Moon to have narrowly missed our shadow
on that occasion.</li>
<li>Skyfield tends to return eclipse times
that are a few seconds earlier than those given by the <em>Canon</em>.
For decades near the present the disagreement
rarely exceeds 2&nbsp;seconds,
but for eclipses 2,000 years ago the difference
can be as large as 20&nbsp;seconds.</li>
<li>Over the full five millennia covered by the <em>Canon</em>,
Skyfield misses only four eclipses, finds two extra eclipses,
and agrees with the <em>Canon</em>’s category
(partial, penumbral, total)
more than 99.8% of the time.
Of the two missing eclipses that are closest to the modern day,
the <em>Canon</em> gives the April&nbsp;859 eclipse
a penumbral magnitude of only 0.0007,
and the February&nbsp;2791 eclipse
a penumbral magnitude of only 0.0006 —
so the missing eclipses were not exactly major celestial events.</li>
</ul>
<p>To help you study each eclipse in greater detail,
Skyfield returns a <code class="docutils literal notranslate"><span class="pre">details</span></code> dictionary of extra arrays
that provide the dimensions of the Moon and of the Earth’s shadow
at the height of the eclipse.
The means of each field is hopefully self-explanatory;
if any of the terms is unfamiliar,
try looking it up online.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">details</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s1">24</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>closest_approach_radians  [0.00657921 0.01029097]
moon_radius_radians       [0.00485608 0.00435481]
penumbra_radius_radians   [0.02278213 0.02077108]
penumbral_magnitude       [2.16831186 1.70327942]
umbra_radius_radians      [0.01332129 0.01161176]
umbral_magnitude          [1.19418911 0.65164729]
</pre></div>
</div>
<p>The first element in each of these sequences
corresponds to the first eclipse we discovered above, on 2019-01-21,
while the second element belongs to the eclipse on&nbsp;2019-07-16.</p>
<p>By combining these dimensions
with the position of the Moon at the height of the eclipse
(which you can generate using Skyfield’s usual approach
to computing a position),
you should be able to produce a detailed diagram of each eclipse.</p>
<p>For a review of the parameters that differ between eclipse forecasts,
see NASA’s
<a class="reference external" href="https://eclipse.gsfc.nasa.gov/LEcat5/shadow.html">Enlargement of Earth’s shadows</a>
page on their Five Millennium Canon site.
If you need lunar eclipse forecasts
generated by a very specific set of parameters,
try cutting and pasting Skyfield’s <code class="docutils literal notranslate"><span class="pre">lunar_eclipses()</span></code> function
into your own code
and making your adjustments there —
you will have complete control of the outcome,
and your application will be immune
to any tweaking that takes place in Skyfield in the future
if it’s found that Skyfield’s eclipse accuracy can become even better.</p>
</div>
</div>

  </body>
</html>