<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example Plots</title>
    <link rel="stylesheet" type="text/css" href="_static/style.css">
  </head>
  <body>
    
    <p class="motto">
      <b>Skyfield:</b>
      <a href=".">Home</a>
      •
      <a href="toc.html">Table of Contents</a>
      •
      <a href="installation.html#changelog">Changelog</a>
      •
      <a href="api.html">API Reference</a>
    </p>
    
    <div class="section" id="example-plots">
<h1>Example Plots<a class="headerlink" href="#example-plots" title="Permalink to this headline">¶</a></h1>
<p>This section of the documentation
will gradually accumulate example scripts
for producing images from Skyfield computations.</p>
<p>Note that these example scripts
are written for fairly recent versions of <a class="reference external" href="https://matplotlib.org/">matplotlib</a>.
If you try running them on a system
with an older version of the library,
you might see errors — in particular with how they specify colors,
in which case you can try omitting those parameters
to get the script running.
In any case,
these are only intended to be a starting point
for building your own scripts,
either with matplotlib or whatever other plotting library you prefer.</p>
<div class="section" id="charting-an-apparition-of-venus">
<span id="venus-chart"></span><h2>Charting an apparition of Venus<a class="headerlink" href="#charting-an-apparition-of-venus" title="Permalink to this headline">¶</a></h2>
<img alt="_images/venus_evening_chart.png" src="_images/venus_evening_chart.png" />
<p>The morning sky and evening sky are popular subjects for astronomy charts,
but they involve a subtlety:
unless the observer is at the equator,
the sun rises and sets at a different time each day.
So whether a chart depicts “the evening sky at sunset”
or “45 minutes after sunset”
or “an hour after sunset”,
its single horizon line represents a different time on each successive day.</p>
<p>Drawing a morning or evening chart therefore involves two steps.
First compute all the times of sunrise or sunset
over the months you are interested in.
Then generate the altitude and azimuth of the target body
at exactly those times for your chart.</p>
<p>This example script generates the Venus chart that you can see above.
A few notes:</p>
<ol class="arabic simple">
<li>The choice of longitude is somewhat arbitrary;
any location at +40°N latitude would generate very nearly the same chart,
since Venus moves only a couple of pixels each day.
But creating an observer on the prime meridian at&nbsp;0° longitude
means that we can brag the diagram is for Greenwich time.</li>
<li>The circles merely represent the visual magnitude of Venus, not its shape.
A&nbsp;more sophisticated chart might show its crescent as it waxes and wanes.</li>
<li>The <em>x</em>-axis limits are hard-coded to make the script easy to read,
but you could probably set them automatically.
If plotting the scene near the north pole,
be careful about the possibility of wrap-around
when the azimuth crosses north and goes back to&nbsp;0°.</li>
<li>There was one specific design tweak made by hand:
the decision to switch the date labels
from one side of the curve to the other
on October&nbsp;1.
But aside from that,
the code tries to be fairly general
and can hopefully serve as a guide
for similar charts of your own.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="kn">from</span> <span class="nn">skyfield</span> <span class="kn">import</span> <span class="n">almanac</span>
<span class="kn">from</span> <span class="nn">skyfield.api</span> <span class="kn">import</span> <span class="n">load</span><span class="p">,</span> <span class="n">wgs84</span>
<span class="kn">from</span> <span class="nn">skyfield.magnitudelib</span> <span class="kn">import</span> <span class="n">planetary_magnitude</span>

<span class="n">MONTH_NAMES</span> <span class="o">=</span> <span class="s1">&#39;0 Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="c1"># Figure out the times of sunset over our range of dates.</span>

<span class="n">eph</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s1">&#39;de421.bsp&#39;</span><span class="p">)</span>
<span class="n">earth</span><span class="p">,</span> <span class="n">sun</span><span class="p">,</span> <span class="n">venus</span> <span class="o">=</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;earth&#39;</span><span class="p">],</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;sun&#39;</span><span class="p">],</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;venus&#39;</span><span class="p">]</span>
<span class="n">observer</span> <span class="o">=</span> <span class="n">wgs84</span><span class="o">.</span><span class="n">latlon</span><span class="p">(</span><span class="o">+</span><span class="mf">40.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">timescale</span><span class="p">()</span>
<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">sunrise_sunset</span><span class="p">(</span><span class="n">eph</span><span class="p">,</span> <span class="n">observer</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">almanac</span><span class="o">.</span><span class="n">find_discrete</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span class="n">sunsets</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">sunsets</span><span class="p">]</span>

<span class="c1"># For each moment of sunset, ask Skyfield for the month number, the day</span>
<span class="c1"># number, and for Venus’s altitude, azimuth, and magnitude.</span>

<span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">utc</span>
<span class="n">month</span> <span class="o">=</span> <span class="n">month</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">day</span> <span class="o">=</span> <span class="n">day</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">apparent</span> <span class="o">=</span> <span class="p">(</span><span class="n">earth</span> <span class="o">+</span> <span class="n">observer</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">venus</span><span class="p">)</span><span class="o">.</span><span class="n">apparent</span><span class="p">()</span>
<span class="n">alt</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">apparent</span><span class="o">.</span><span class="n">altaz</span><span class="p">()</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">degrees</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">degrees</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">planetary_magnitude</span><span class="p">(</span><span class="n">apparent</span><span class="p">)</span>

<span class="c1"># Convert magnitude to marker size, remembering that smaller magnitude</span>
<span class="c1"># numbers mean a brighter Venus (and thus a larger marker).</span>

<span class="n">maxmag</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">minmag</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">size</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">minmag</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">maxmag</span> <span class="o">-</span> <span class="n">minmag</span><span class="p">)</span>

<span class="c1"># Start with a smooth curve tracing Venus&#39;s motion.</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#fff6&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Next, put a circle representing Venus on the 1st of the month and on</span>
<span class="c1"># every fifth day after that.  (Except for the 30th, which would sit too</span>
<span class="c1"># close to the 1st of the following month.)</span>

<span class="n">fives</span> <span class="o">=</span> <span class="p">(</span><span class="n">day</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">day</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">fives</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">fives</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="n">fives</span><span class="p">],</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
           <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Put day and month labels off to the sides of the curve.</span>

<span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">fives</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">continue</span>  <span class="c1"># We can’t compute dx/dy with no previous point.</span>

    <span class="c1"># Build a unit vector pointing in the direction Venus is traveling.</span>

    <span class="n">day_i</span> <span class="o">=</span> <span class="n">day</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">yi</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">xi</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">/=</span> <span class="n">length</span>
    <span class="n">dy</span> <span class="o">/=</span> <span class="n">length</span>

    <span class="c1"># Offset the text at a right angle to the direction of travel.</span>

    <span class="n">side</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">month</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;left&#39;</span>
    <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
        <span class="n">xytext</span> <span class="o">=</span> <span class="o">-</span> <span class="n">offset_x</span><span class="o">*</span><span class="n">dy</span><span class="p">,</span> <span class="n">offset_y</span><span class="o">*</span><span class="n">dx</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xytext</span> <span class="o">=</span> <span class="n">offset_x</span><span class="o">*</span><span class="n">dy</span><span class="p">,</span> <span class="o">-</span> <span class="n">offset_y</span><span class="o">*</span><span class="n">dx</span>

    <span class="c1"># Label the dates 1, 11, and 21.</span>

    <span class="k">if</span> <span class="n">day_i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">21</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">day_i</span><span class="p">,</span> <span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="n">xytext</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="c1"># On the 15th of each month, put the month name.</span>

    <span class="k">if</span> <span class="n">day_i</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">MONTH_NAMES</span><span class="p">[</span><span class="n">month</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="mf">2.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xytext</span><span class="p">))</span>

<span class="c1"># Finally, some decorations.</span>

<span class="n">points</span> <span class="o">=</span> <span class="s1">&#39;N NE E SE S SW W NW&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">aspect</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Venus at sunset for 40°N latitude, April 2021 – January 2022&#39;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Azimuth (°)&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Altitude (°)&#39;</span><span class="p">,</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">195</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">10.0</span><span class="p">),</span>
    <span class="n">xticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">210</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">sky</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;sky&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">])</span>
<span class="n">extent</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">sky</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bicubic&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;venus_evening_chart.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="drawing-a-finder-chart-for-comet-neowise">
<span id="neowise-chart"></span><h2>Drawing a finder chart for comet NEOWISE<a class="headerlink" href="#drawing-a-finder-chart-for-comet-neowise" title="Permalink to this headline">¶</a></h2>
<p>Here is a stand-alone script
that brings together four different data sources —
a planetary ephemeris, a comet orbit database, a large star catalog,
and constellation diagrams —
to plot the course of Comet NEOWISE across Ursa Major
over one week of July&nbsp;2020:</p>
<img alt="_images/neowise-finder-chart.png" src="_images/neowise-finder-chart.png" />
<p>Its code includes many design decisions and presentation tweaks
that you will probably want to adjust for your own project.
Use the script as a starting point:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">LineCollection</span>

<span class="kn">from</span> <span class="nn">skyfield.api</span> <span class="kn">import</span> <span class="n">Star</span><span class="p">,</span> <span class="n">load</span>
<span class="kn">from</span> <span class="nn">skyfield.constants</span> <span class="kn">import</span> <span class="n">GM_SUN_Pitjeva_2005_km3_s2</span> <span class="k">as</span> <span class="n">GM_SUN</span>
<span class="kn">from</span> <span class="nn">skyfield.data</span> <span class="kn">import</span> <span class="n">hipparcos</span><span class="p">,</span> <span class="n">mpc</span><span class="p">,</span> <span class="n">stellarium</span>
<span class="kn">from</span> <span class="nn">skyfield.projections</span> <span class="kn">import</span> <span class="n">build_stereographic_projection</span>

<span class="c1"># The comet is plotted on several dates `t_comet`.  But the stars only</span>
<span class="c1"># need to be drawn once, so we take the middle comet date as the single</span>
<span class="c1"># time `t` we use for everything else.</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">timescale</span><span class="p">()</span>
<span class="n">t_comet</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">27</span><span class="p">))</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t_comet</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_comet</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># middle date</span>

<span class="c1"># An ephemeris from the JPL provides Sun and Earth positions.</span>

<span class="n">eph</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s1">&#39;de421.bsp&#39;</span><span class="p">)</span>
<span class="n">sun</span> <span class="o">=</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;sun&#39;</span><span class="p">]</span>
<span class="n">earth</span> <span class="o">=</span> <span class="n">eph</span><span class="p">[</span><span class="s1">&#39;earth&#39;</span><span class="p">]</span>

<span class="c1"># The Minor Planet Center data file provides the comet orbit.</span>

<span class="k">with</span> <span class="n">load</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mpc</span><span class="o">.</span><span class="n">COMET_URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">comets</span> <span class="o">=</span> <span class="n">mpc</span><span class="o">.</span><span class="n">load_comets_dataframe</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">comets</span> <span class="o">=</span> <span class="p">(</span><span class="n">comets</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;reference&#39;</span><span class="p">)</span>
          <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;designation&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
          <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;designation&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="n">row</span> <span class="o">=</span> <span class="n">comets</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;C/2020 F3 (NEOWISE)&#39;</span><span class="p">]</span>
<span class="n">comet</span> <span class="o">=</span> <span class="n">sun</span> <span class="o">+</span> <span class="n">mpc</span><span class="o">.</span><span class="n">comet_orbit</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">GM_SUN</span><span class="p">)</span>

<span class="c1"># The Hipparcos mission provides our star catalog.</span>

<span class="k">with</span> <span class="n">load</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">hipparcos</span><span class="o">.</span><span class="n">URL</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">stars</span> <span class="o">=</span> <span class="n">hipparcos</span><span class="o">.</span><span class="n">load_dataframe</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c1"># And the constellation outlines come from Stellarium.  We make a list</span>
<span class="c1"># of the stars at which each edge stars, and the star at which each edge</span>
<span class="c1"># ends.</span>

<span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/Stellarium/stellarium/master&#39;</span>
       <span class="s1">&#39;/skycultures/western_SnT/constellationship.fab&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">load</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">constellations</span> <span class="o">=</span> <span class="n">stellarium</span><span class="o">.</span><span class="n">parse_constellations</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">edge</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">edges</span> <span class="ow">in</span> <span class="n">constellations</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">]</span>
<span class="n">edges_star1</span> <span class="o">=</span> <span class="p">[</span><span class="n">star1</span> <span class="k">for</span> <span class="n">star1</span><span class="p">,</span> <span class="n">star2</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">]</span>
<span class="n">edges_star2</span> <span class="o">=</span> <span class="p">[</span><span class="n">star2</span> <span class="k">for</span> <span class="n">star1</span><span class="p">,</span> <span class="n">star2</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">]</span>

<span class="c1"># We will center the chart on the comet&#39;s middle position.</span>

<span class="n">center</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">comet</span><span class="p">)</span>
<span class="n">projection</span> <span class="o">=</span> <span class="n">build_stereographic_projection</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
<span class="n">field_of_view_degrees</span> <span class="o">=</span> <span class="mf">45.0</span>
<span class="n">limiting_magnitude</span> <span class="o">=</span> <span class="mf">7.0</span>

<span class="c1"># Now that we have constructed our projection, compute the x and y</span>
<span class="c1"># coordinates that each star and the comet will have on the plot.</span>

<span class="n">star_positions</span> <span class="o">=</span> <span class="n">earth</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">Star</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">stars</span><span class="p">))</span>
<span class="n">stars</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">stars</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">projection</span><span class="p">(</span><span class="n">star_positions</span><span class="p">)</span>

<span class="n">comet_x</span><span class="p">,</span> <span class="n">comet_y</span> <span class="o">=</span> <span class="n">projection</span><span class="p">(</span><span class="n">earth</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">t_comet</span><span class="p">)</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">comet</span><span class="p">))</span>

<span class="c1"># Create a True/False mask marking the stars bright enough to be</span>
<span class="c1"># included in our plot.  And go ahead and compute how large their</span>
<span class="c1"># markers will be on the plot.</span>

<span class="n">bright_stars</span> <span class="o">=</span> <span class="p">(</span><span class="n">stars</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">&lt;=</span> <span class="n">limiting_magnitude</span><span class="p">)</span>
<span class="n">magnitude</span> <span class="o">=</span> <span class="n">stars</span><span class="p">[</span><span class="s1">&#39;magnitude&#39;</span><span class="p">][</span><span class="n">bright_stars</span><span class="p">]</span>
<span class="n">marker_size</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">limiting_magnitude</span> <span class="o">-</span> <span class="n">magnitude</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span>

<span class="c1"># The constellation lines will each begin at the x,y of one star and end</span>
<span class="c1"># at the x,y of another.  We have to &quot;rollaxis&quot; the resulting coordinate</span>
<span class="c1"># array into the shape that matplotlib expects.</span>

<span class="n">xy1</span> <span class="o">=</span> <span class="n">stars</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">edges_star1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">xy2</span> <span class="o">=</span> <span class="n">stars</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">edges_star2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">lines_xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xy1</span><span class="p">,</span> <span class="n">xy2</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Time to build the figure!</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>

<span class="c1"># Draw the constellation lines.</span>

<span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">LineCollection</span><span class="p">(</span><span class="n">lines_xy</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;#00f2&#39;</span><span class="p">))</span>

<span class="c1"># Draw the stars.</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">stars</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="n">bright_stars</span><span class="p">],</span> <span class="n">stars</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">][</span><span class="n">bright_stars</span><span class="p">],</span>
           <span class="n">s</span><span class="o">=</span><span class="n">marker_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># Draw the comet positions, and label them with dates.</span>

<span class="n">comet_color</span> <span class="o">=</span> <span class="s1">&#39;#f00&#39;</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mf">0.002</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">comet_x</span><span class="p">,</span> <span class="n">comet_y</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">comet_color</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">tstr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">comet_x</span><span class="p">,</span> <span class="n">comet_y</span><span class="p">,</span> <span class="n">t_comet</span><span class="o">.</span><span class="n">utc_strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)):</span>
    <span class="n">tstr</span> <span class="o">=</span> <span class="n">tstr</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xi</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">yi</span> <span class="o">-</span> <span class="n">offset</span><span class="p">,</span> <span class="n">tstr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">comet_color</span><span class="p">,</span>
                   <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">text</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Finally, title the plot and set some final parameters.</span>

<span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">field_of_view_degrees</span> <span class="o">/</span> <span class="mf">360.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">limit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comet NEOWISE </span><span class="si">{}</span><span class="s1"> through </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">t_comet</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">utc_strftime</span><span class="p">(</span><span class="s1">&#39;%Y %B </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span>
    <span class="n">t_comet</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">utc_strftime</span><span class="p">(</span><span class="s1">&#39;%Y %B </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span>
<span class="p">))</span>

<span class="c1"># Save.</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;neowise-finder-chart.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you choose a different rendering engine
instead of the venerable but rather ornery and complicated <a class="reference external" href="https://matplotlib.org/">matplotlib</a>,
then of course the plotting calls you make
will be completely different.
But the basic data loading and filtering will be the same,
so hopefully the script will still help get you started
in targeting a more modern plotting library.</p>
</div>
<div class="section" id="plotting-satellite-altitude-during-re-entry">
<h2>Plotting satellite altitude during re-entry<a class="headerlink" href="#plotting-satellite-altitude-during-re-entry" title="Permalink to this headline">¶</a></h2>
<p>Here is the decreasing altitude of a satellite as its orbit decayed
and it re-entered the atmosphere above the Pacific Ocean:</p>
<img alt="_images/goce-reentry.png" src="_images/goce-reentry.png" />
<p>The code to produce the diagram using <a class="reference external" href="https://matplotlib.org/">matplotlib</a>,
including custom tick marks that are based on the date,
is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.dates</span> <span class="kn">import</span> <span class="n">HourLocator</span><span class="p">,</span> <span class="n">DateFormatter</span>

<span class="kn">from</span> <span class="nn">skyfield.api</span> <span class="kn">import</span> <span class="n">load</span><span class="p">,</span> <span class="n">EarthSatellite</span>

<span class="c1"># Labels for both date and hour on the x axis, and km on y.</span>

<span class="k">def</span> <span class="nf">label_dates_and_hours</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">HourLocator</span><span class="p">([</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">HourLocator</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">18</span><span class="p">]))</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;0h</span><span class="se">\n</span><span class="s1">%Y %b </span><span class="si">%d</span><span class="se">\n</span><span class="s1">%A&#39;</span><span class="p">))</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Hh&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_horizontalalignment</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{x:.0f}</span><span class="s1"> km&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Load the satellite&#39;s final TLE entry.</span>

<span class="n">sat</span> <span class="o">=</span> <span class="n">EarthSatellite</span><span class="p">(</span>
    <span class="s1">&#39;1 34602U 09013A   13314.96046236  .14220718  20669-5  50412-4 0   930&#39;</span><span class="p">,</span>
    <span class="s1">&#39;2 34602 096.5717 344.5256 0009826 296.2811 064.0942 16.58673376272979&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GOCE&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Build the time range `t` over which to plot, plus other values.</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">timescale</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">tt_jd</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sat</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">tt</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">sat</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">tt</span> <span class="o">+</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">))</span>
<span class="n">reentry</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">utc</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">earth_radius_km</span> <span class="o">=</span> <span class="mf">6371.0</span>

<span class="c1"># Compute geocentric positions for the satellite.</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">sat</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">valid</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">message</span><span class="p">]</span>

<span class="c1"># Start a new figure.</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># Draw the blue curve.</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">utc_datetime</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">valid</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span><span class="o">.</span><span class="n">km</span> <span class="o">-</span> <span class="n">earth_radius_km</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Label the TLE epoch.</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">sat</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">utc_datetime</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sat</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">sat</span><span class="o">.</span><span class="n">epoch</span><span class="p">)</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span><span class="o">.</span><span class="n">km</span> <span class="o">-</span> <span class="n">earth_radius_km</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;Epoch of TLE data &#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

<span class="c1"># Label the official moment of reentry.</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">reentry</span><span class="o">.</span><span class="n">utc_datetime</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sat</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">reentry</span><span class="p">)</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span><span class="o">.</span><span class="n">km</span> <span class="o">-</span> <span class="n">earth_radius_km</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; Moment of re-entry&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="c1"># Grid lines and labels.</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;GOCE satellite: altitude above sea level&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
<span class="n">label_dates_and_hours</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

<span class="c1"># Render the plot to a PNG file.</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;goce-reentry.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

  </body>
</html>